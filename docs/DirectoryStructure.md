# Directory Structure

:exclamation: This is work in progress

## Project Root

* `api`: the backend code
* `config`: the backend code
* `ui`: the frontend code
* `data`: the place where the data resides. This can be both data delivered with
   the product, e.g. the label types, or the sqlite database for the product.
* `docs`: This documentation
* `log`: This is the default place for the logs

## API

* `bin`: Scripts to manage the API
* `src`: the backend code
* The other files and directories are related to Node itself or to the
  development environment.

## API/bin - DEPRECATED

* `generate_labels`: DEPRECATED - will be removed

## API/src

This is the root for the API code.

Files

* `index.js`: This is the script that kicks off the server side of SI.

Directories

* `classes`: Manage specific resources and hide details from the rest of the application
* `config`: contains a database configuration file
* `controllers`: contains the controllers called from the routers
* `migrations`: scripts to move the database along
* `models`: contains the database models
* `routers`: contains the routers
* `utils`: contains the routers

## API/src/classes

Classes abstract certain data structures or concepts

* `labelfile.js`: :exclamation: DEPRECATED
* `labeltypes.js`: :exclamation: DEPRECATED
* `ivtserror.js`: error class

## API/src/config

:exclamation: --- NEEDS REFACTORING --- this directory should move to ~.

* `db.json`: configuration for the DB connection.

## API/src/controllers

Controllers are functions called from the routers. The routes are grouped by
the exposed data structures, the controllers should mimic that grouping.

Files

* `generic.js`: generic controllers do not expose an actual object
* `items.js`: All functions linked to the `/items`-endpoint
* `labels.js`: All functions linked to the `/labels`-endpoint
* `places.js`: All functions linked to the `/places`-endpoint

Directories

* `labels`: DEPRECATED

## API/src/controllers/labels

DEPRECATED

## API/src/migrations

The files in here maintain the database structure. Upon startup the SIS
validates if all the migrations are run. In order the migrations

* create the labels table
* create the places table
* create the items table

## API/src/models

This directory contains the models for the `sequelize` models

Files

* `label.js`: The DB interactions for labels
* `place.js`: The DB interactions for places
* `item.js`: The DB interactions for items
* `index.js`: Initializes the DB structure

## API/src/routers

In this directory we map the endpoints to the functions in the controllers

Files

* `main.js`: All single endpoints are mapped here
* `label.js`: DEPRECATED

## API/src/utils

In this directory find utilities that hide configuration interpretations or
generic functions.

Files

* `logger.js`: logging functionality
* `error.js`: contains the error messages that are sent back to the front end
* `unique.js`: contains the generation of unique identifiers

## Config

This directory contains configuration files. If config is used by different
modules it should be configured only once.

* `db.json`: connection parameters for sequelize

## User interface (ui)

Directories

* `public`: this directory contains the static content of SI
* `src`: this directory contains the the frontend code

## UI/public

The initial version of this file is generated by `vue-cli`. We used this to set
up a quick start project.

Files:

* `index.html`: The initial page of SI.
* `favicon.ico`: the icon shown in the address bar of the browser

## UI/src

Files

* `main.js`: this code does the initialization and configuration of the user
  interface. When this is finished it hands control over to Vue.
* `App.vue`: The initial Vue view. It sets up the general structure as a header,
  menu and content part

Directories

* `assets`: this directory contains static information. (Currently not used)
* `classes`: contains classes that hide ui logic.
* `components`: contains reusable components used in views.
* `router`: this is the Vue router, linking URLs to views. Contains only one file.
* `service`: contains the REST calls to the backend
* `utils`: different functions that are needed across the UI
* `views`: the screens that take the place of the content part in `App.vue`

## UI/src/classes

Classes are used within the `state` (our own implementation of the Vue store)
Most of the state elements are managed by a class. This allows views and
components to treat them as reactive.

The state contains

| file  | state element | description |
| ----- | ------------- | ----------- |
| `itemdescription.js` | `itemDescriptions` | a list of used item descriptions,used to auto-complete input fields |
| `items.js` | `createdItems` | a list of items that was created during this session. Used in the `itemAdd.vue`-view |
| `labels.js` | `labels` | the UI pre-fetches labels. This manages this cache |
| `places.js` | `places` | a list of places, used to fill dropdowns for place selection. |

## UI/src/components

This directory contains parts of views that have been separated out of the view.
This can be done for different reasons.

* it is a component of its own right
  * `menu.vue`: shows the menu
* it was mandatory because of the `Suspense` keyword
  * `placestable.vue`: the overview table containing the places.

## UI/src/services

The services called by the UI. The services are described in the API docs.

| files | endpoint |
| ----- | -------- |
| `items.js` | `/items` |
| `labels.js` | `/labels` |
| `place.js` | `/places` |

This is a list of the services called

| Operator | endpoint | description |
| -------- | -------- | ----------- |
| `GET` | `/items?p=itemdescriptions` | retrieves a list of distinct item descriptions
| `POST` | `/items` | creates one or more items
| `PUT` | `/labels` | locks a set of labels and returns them.
| `GET` | `/places` | get a list of all defined places
| `POST` | `/places` | creates a place

## UI/src/utils

This directory contains a set of utilities.

Some of them are used to set up parts of the system.

| file | description |
| ---- | ----------- |
| `event.js` | sets up an event bus.
| `ivts.js` | sets up the axios connection to the backend
| `state.js` | sets up a global data structure

Besides that the directory contains commonly used functions:

* `unique.js`: generate unique numbers
* `notify.js`: this uses the event bus to send toast messages

## UI/src/views

Each entry in the menu should have a corresponding view file.

| Menu entry | View |
| ---------- | ---- |
| Artikelen/Overzicht | not implemented yet
| Artikelen/Aanmaken | `itemadd.vue`
| Plaatsen/Overzicht | `places.vue`
| Plaatsen/Aanmaken | `placeadd.vue`
